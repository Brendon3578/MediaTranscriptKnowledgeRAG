# ğŸ§  PRD â€” Plataforma de TranscriÃ§Ã£o Segmentada + Embeddings (RAG-ready)

## 1ï¸âƒ£ VisÃ£o Geral

Sistema baseado em **microserviÃ§os orientados a eventos** para:

* Upload de Ã¡udio/vÃ­deo
* TranscriÃ§Ã£o **segmentada por tempo**
* GeraÃ§Ã£o futura de **embeddings por segmento**
* Consulta semÃ¢ntica via LLM (RAG)

Arquitetura pensada para:

* reprocessamento
* auditoria
* evoluÃ§Ã£o de modelos
* explicabilidade (timestamp)

---

## 2ï¸âƒ£ Objetivos do Produto

âœ” Transcrever mÃ­dia em **segmentos temporais**
âœ” Permitir **busca semÃ¢ntica precisa**
âœ” Associar respostas a **momentos do vÃ­deo/Ã¡udio**
âœ” Ser **agnÃ³stico de IA** (local ou cloud)
âœ” Escalar por eventos (RabbitMQ)

---

## 3ï¸âƒ£ Fluxo Geral (Event-Driven)

```txt
Upload.Api
  â†’ media.uploaded
      â†“
Transcription.Worker
  â†’ transcriÃ§Ã£o segmentada
  â†’ media.transcribed
      â†“
Embedding.Worker
  â†’ embedding por segmento
      â†“
Query.Api (RAG)
```

---

## 4ï¸âƒ£ MicroserviÃ§os e Responsabilidades

### ğŸ“¤ Upload.Api

* Recebe arquivo
* Salva localmente
* Registra `media`
* Publica `MediaUploadedEvent`

---

### ğŸ™ Transcription.Worker

* Consome `media.uploaded`
* Extrai Ã¡udio (FFmpeg)
* Transcreve via Whisper local
* **Gera segmentos com timestamps**
* Salva segmentos no banco
* Publica `MediaTranscribedEvent`

---

### ğŸ§  Embedding.Worker (futuro)

* Consome `media.transcribed`
* Gera embedding **por segmento**
* Salva no pgvector

---

### ğŸ” Query.Api (futuro)

* Busca semÃ¢ntica por embedding
* Retorna:

  * texto
  * timestamp
  * referÃªncia de mÃ­dia

---

## 5ï¸âƒ£ Modelo de Dados (PostgreSQL + pgvector)

### ğŸ“„ media

```sql
id UUID PK
file_name TEXT
file_path TEXT
content_type TEXT
duration_seconds INT
status TEXT
created_at TIMESTAMP
```

---

### ğŸ“ transcriptions

```sql
id UUID PK
media_id UUID FK
language TEXT
model_used TEXT
created_at TIMESTAMP
```

---

### ğŸ§© transcription_segments â­ (NOVA BASE)

```sql
id UUID PK
transcription_id UUID FK
media_id UUID FK
segment_index INT
text TEXT
start_seconds REAL
end_seconds REAL
confidence REAL
created_at TIMESTAMP
```

 ğŸ”‘ **Essa tabela Ã© a base do RAG**

---

### ğŸ“ embeddings (futuro)

```sql
id UUID PK
segment_id UUID FK
vector VECTOR(1536)
created_at TIMESTAMP
```

---

## 6ï¸âƒ£ DecisÃµes Importantes (Justificadas)

### Por que segmentar?

* Whisper jÃ¡ retorna segmentos
* Embedding por segmento = respostas melhores
* Evita chunking artificial depois

### Por que nÃ£o salvar texto inteiro?

* Perde contexto temporal
* Embedding fica â€œgenÃ©ricoâ€
* NÃ£o permite referÃªncia ao tempo

---

## 7ï¸âƒ£ Eventos (contratos)

### MediaUploadedEvent

* unchanged

### MediaTranscribedEvent

```json
{
  "mediaId": "guid",
  "transcriptionId": "guid",
  "segmentsCount": 42
}
```

---

## 8ï¸âƒ£ MÃ©tricas importantes (futuro)

* tempo total de transcriÃ§Ã£o
* duraÃ§Ã£o mÃ©dia por segmento
* tokens por segmento
* custo por mÃ­dia
